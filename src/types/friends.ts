/**
 * 友链管理相关类型定义
 * 对接 anheyu-pro 后端 /api/links 和相关接口
 */

// ===================================
//          核心数据模型
// ===================================

/** 友链状态 */
export type LinkStatus = "PENDING" | "APPROVED" | "REJECTED" | "INVALID";

/** 友链申请类型 */
export type LinkApplyType = "NEW" | "UPDATE";

/** 友链分类 */
export interface LinkCategory {
  id: number;
  name: string;
  style: "card" | "list";
  description: string;
}

/** 友链标签 */
export interface LinkTag {
  id: number;
  name: string;
  color: string;
}

/** 友链实体 */
export interface LinkItem {
  id: number;
  name: string;
  url: string;
  logo: string;
  description: string;
  status: LinkStatus;
  siteshot: string;
  sort_order: number;
  skip_health_check: boolean;
  email: string;
  type?: LinkApplyType;
  original_url?: string;
  update_reason?: string;
  category: LinkCategory | null;
  tag: LinkTag | null;
}

// ===================================
//        查询参数类型
// ===================================

/** 管理端友链列表查询参数 */
export interface AdminLinksParams {
  page?: number;
  pageSize?: number;
  name?: string;
  url?: string;
  description?: string;
  status?: LinkStatus | "";
  category_id?: number | "";
  tag_id?: number | "";
}

// ===================================
//          响应类型
// ===================================

/** 友链分页列表响应 */
export interface LinkListResponse {
  list: LinkItem[];
  total: number;
  page: number;
  pageSize: number;
}

// ===================================
//        请求体类型
// ===================================

/** 创建友链请求 */
export interface CreateLinkRequest {
  name: string;
  url: string;
  logo: string;
  description: string;
  siteshot: string;
  email?: string;
  type?: LinkApplyType;
  original_url?: string;
  update_reason?: string;
  category_id: number;
  tag_id: number | null;
  status: LinkStatus;
  sort_order: number;
  skip_health_check: boolean;
}

/** 更新友链请求 */
export type UpdateLinkRequest = CreateLinkRequest;

/** 审核友链请求 */
export interface ReviewLinkRequest {
  status: "APPROVED" | "REJECTED";
  siteshot?: string;
  reject_reason?: string;
}

/** 创建友链分类请求 */
export interface CreateCategoryRequest {
  name: string;
  style: "card" | "list";
  description?: string;
}

/** 更新友链分类请求 */
export type UpdateCategoryRequest = CreateCategoryRequest;

/** 创建友链标签请求 */
export interface CreateTagRequest {
  name: string;
  color?: string;
}

/** 更新友链标签请求 */
export type UpdateTagRequest = CreateTagRequest;

// ===================================
//        批量导入类型
// ===================================

/** 导入友链的单个数据项 */
export interface ImportLinkItem {
  name: string;
  url: string;
  logo?: string;
  description?: string;
  siteshot?: string;
  email?: string;
  category_name?: string;
  tag_name?: string;
  tag_color?: string;
  status?: LinkStatus;
}

/** 批量导入友链请求 */
export interface ImportLinksRequest {
  links: ImportLinkItem[];
  skip_duplicates?: boolean;
  create_categories?: boolean;
  create_tags?: boolean;
  default_category_id?: number;
}

/** 导入失败项 */
export interface ImportLinkFailure {
  link: ImportLinkItem;
  reason: string;
}

/** 导入跳过项 */
export interface ImportLinkSkipped {
  link: ImportLinkItem;
  reason: string;
}

/** 批量导入友链响应 */
export interface ImportLinksResponse {
  total: number;
  success: number;
  failed: number;
  skipped: number;
  success_list: LinkItem[];
  failed_list: ImportLinkFailure[];
  skipped_list: ImportLinkSkipped[];
}

// ===================================
//        导出类型
// ===================================

/** 导出友链查询参数 */
export interface ExportLinksParams {
  name?: string;
  url?: string;
  description?: string;
  status?: LinkStatus;
  category_id?: number;
  tag_id?: number;
}

/** 导出友链响应 */
export interface ExportLinksResponse {
  links: ImportLinkItem[];
  total: number;
}

// ===================================
//        健康检查类型
// ===================================

/** 友链健康检查结果 */
export interface LinkHealthCheckResult {
  total: number;
  healthy: number;
  unhealthy: number;
  unhealthy_ids: number[];
}

/** 友链健康检查状态响应 */
export interface LinkHealthCheckResponse {
  is_running: boolean;
  start_time?: string;
  end_time?: string;
  result?: LinkHealthCheckResult;
  error?: string;
}

// ===================================
//        排序类型
// ===================================

/** 单个友链排序项 */
export interface LinkSortItem {
  id: number;
  sort_order: number;
}

/** 批量更新友链排序请求 */
export interface BatchUpdateLinkSortRequest {
  items: LinkSortItem[];
}
